<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Comparison Report</title>
    <style>
        {{ css_styles }}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç API Comparison Report</h1>
            <div class="report-info">
                Generated on {{ result.comparison_timestamp | date.to_string "%Y-%m-%d %H:%M:%S" }}
            </div>
        </header>

        <!-- Metadata section -->
        <section class="metadata">
            <h2>üìä Metadata</h2>
            <div class="metadata-content">
                <div class="assembly-info">
                    <div class="assembly-card source">
                        <div class="assembly-label">Source Assembly</div>
                        <div class="assembly-name">{{ result.old_assembly_name }}</div>
                        <div class="assembly-path">{{ result.old_assembly_path }}</div>
                    </div>
                    <div class="assembly-card target">
                        <div class="assembly-label">Target Assembly</div>
                        <div class="assembly-name">{{ result.new_assembly_name }}</div>
                        <div class="assembly-path">{{ result.new_assembly_path }}</div>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value">{{ result.total_differences }}</div>
                        <div class="stat-label">Total Differences</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ result.comparison_timestamp | date.to_string "%Y-%m-%d" }}</div>
                        <div class="stat-label">Comparison Date</div>
                    </div>
                    {{if result.has_breaking_changes}}
                    <div class="stat-item breaking">
                        <div class="stat-value">{{ result.breaking_changes_count }}</div>
                        <div class="stat-label">Breaking Changes</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </section>

        <!-- Summary section -->
        <section class="summary">
            <h2>üìà Summary</h2>
            <div class="summary-cards">
                <div class="summary-card added clickable" onclick="navigateToSection('added-items')">
                    <div class="card-number">{{ result.summary.added_count }}</div>
                    <div class="card-label">Added</div>
                </div>
                <div class="summary-card removed clickable" onclick="navigateToSection('removed-items')">
                    <div class="card-number">{{ result.summary.removed_count }}</div>
                    <div class="card-label">Removed</div>
                </div>
                <div class="summary-card modified clickable" onclick="navigateToSection('modified-items')">
                    <div class="card-number">{{ result.summary.modified_count }}</div>
                    <div class="card-label">Modified</div>
                </div>
                {{if result.summary.breaking_changes_count > 0}}
                <div class="summary-card breaking clickable" onclick="navigateToSection('breaking-changes')">
                    <div class="card-number">{{ result.summary.breaking_changes_count }}</div>
                    <div class="card-label">Breaking</div>
                </div>
                {{else}}
                <div class="summary-card breaking">
                    <div class="card-number">{{ result.summary.breaking_changes_count }}</div>
                    <div class="card-label">Breaking</div>
                </div>
                {{end}}
            </div>
        </section>

        <!-- Configuration section -->
        <section class="configuration">
            <h2>‚öôÔ∏è Configuration</h2>
            <div class="config-toggle">
                <button onclick="toggleConfig()" class="toggle-button">
                    <span class="toggle-icon">‚ñ∂</span>
                    <span class="toggle-text">Show Configuration Details</span>
                </button>
            </div>
            <div id="config-details" class="config-details" style="display: none;">
                {{ include "configuration" }}
            </div>
        </section>

        <!-- Breaking changes section -->
        {{if result.has_breaking_changes}}
        <section class="breaking-changes" id="breaking-changes">
            <div class="section-header" onclick="toggleSection('breaking-changes')">
                <h2>‚ö†Ô∏è Breaking Changes</h2>
                <button class="section-toggle collapsed">
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
            </div>
            <div class="section-content collapsed" id="breaking-changes-content">
                <div class="alert alert-danger">
                    <strong>Warning:</strong> The following changes may break compatibility with existing code.
                </div>
                <!-- Breaking changes content directly inline for debugging -->
                <div class="breaking-changes-table">
                <table>
                    <thead>
                        <tr>
                            <th>Severity</th>
                            <th>Type</th>
                            <th>Element</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{for change in result.breaking_changes}}
                        <tr>
                            <td><span class="severity {{ change.severity_class }}">{{ change.severity }}</span></td>
                            <td>{{ change.element_type }}</td>
                            <td><code>{{ change.element_name }}</code></td>
                            <td>{{ change.description }}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            </div>
        </section>
        {{end}}

        <!-- Change sections -->
        {{for section in change_sections}}
        <section class="changes-section" id="{{ section.change_type }}-items">
            <div class="section-header" onclick="toggleSection('{{ section.change_type }}-items')">
                <h2>{{ section.icon }} {{ section.title }} ({{ section.count }})</h2>
                <button class="section-toggle collapsed">
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
            </div>
            <div class="section-content collapsed" id="{{ section.change_type }}-items-content">
                {{if section.description}}
                <p class="section-description">{{ section.description }}</p>
                {{end}}
                <!-- Type groups within this change category -->
                {{for group in section.grouped_changes}}
                <div class="type-group">
                    <div class="type-header" onclick="toggleTypeGroup('{{ section.change_type }}-{{ group.key | string.replace " " "-" | string.replace "." "-" | string.replace "`" "-" }}')">
                        <h3 class="type-name">
                            üìÅ {{ group.key }}
                            <span class="type-summary">
                                ({{ group.count }} change{{ if group.count != 1 }}s{{ end }}{{ if group.has_breaking_changes }}, {{ group.breaking_changes_count }} breaking{{ end }})
                            </span>
                        </h3>
                        <div class="type-header-controls">
                            {{if group.has_breaking_changes}}
                            <span class="breaking-type-badge">‚ö†Ô∏è Breaking Changes</span>
                            {{end}}
                            <button class="type-toggle collapsed">
                                <span class="toggle-icon">‚ñ∂</span>
                            </button>
                        </div>
                    </div>

                    <div class="type-changes collapsed" id="{{ section.change_type }}-{{ group.key | string.replace " " "-" | string.replace "." "-" | string.replace "`" "-" }}-content">
                        <div class="category-changes">
                            {{for change in group.changes}}
                            <div class="change-item {{ section.change_type }}">
                                <div class="change-header">
                                    <div class="change-name">
                                        <span class="element-type">{{ change.element_type }}</span>
                                        <code>{{ change.element_name }}</code>
                                        {{if change.is_breaking_change}}
                                        <span class="breaking-badge">BREAKING</span>
                                        {{end}}
                                    </div>
                                    <div class="change-description">{{ change.description }}</div>
                                </div>
                                {{if change.has_signatures}}
                                <div class="signature-toggle">
                                    <button class="toggle-btn" onclick="toggleSignature('{{ change.details_id }}')">
                                        <span class="toggle-icon">‚ñº</span> View Signature Details
                                    </button>
                                </div>
                                <div id="{{ change.details_id }}" class="signature-details" style="display: none;">
                                    {{if change.old_signature}}
                                    <div class="signature-section">
                                        <h5>Old Signature:</h5>
                                        <pre><code class="csharp">{{ change.old_signature }}</code></pre>
                                    </div>
                                    {{end}}
                                    {{if change.new_signature}}
                                    <div class="signature-section">
                                        <h5>New Signature:</h5>
                                        <pre><code class="csharp">{{ change.new_signature }}</code></pre>
                                    </div>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                            {{end}}
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
        </section>
        {{end}}
    </div>

    <script>
        {{ javascript_code }}
    </script>
</body>
</html>
